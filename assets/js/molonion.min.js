(o=>{"object"==typeof module&&"object"==typeof module.exports?o(require("jquery"),window,document):o(jQuery,window,document)})(function(s,o,t,i){function l(){return n.length?n[n.length-1]:null}function e(){for(var o=!1,t=n.length-1;0<=t;t--)n[t].$blocker&&(n[t].$blocker.toggleClass("current",!o).toggleClass("behind",o),o=!0)}var n=[];s.modal=function(i,o){var e;if(this.$body=s("body"),this.options=s.extend({},s.modal.defaults,o),this.options.doFade=!isNaN(parseInt(this.options.fadeDuration,10)),this.$blocker=null,this.options.closeExisting)for(;s.modal.isActive();)s.modal.close();if(n.push(this),i.is("a"))if(o=i.attr("href"),this.anchor=i,/^#/.test(o)){if(this.$elm=s(o),1!==this.$elm.length)return null;this.$body.append(this.$elm),this.open()}else this.$elm=s("<div>"),this.$body.append(this.$elm),e=function(o,t){t.elm.remove()},this.showSpinner(),i.trigger(s.modal.AJAX_SEND),s.get(o).done(function(o){var t;s.modal.isActive()&&(i.trigger(s.modal.AJAX_SUCCESS),(t=l()).$elm.empty().append(o).on(s.modal.CLOSE,e),t.hideSpinner(),t.open(),i.trigger(s.modal.AJAX_COMPLETE))}).fail(function(){i.trigger(s.modal.AJAX_FAIL),l().hideSpinner(),n.pop(),i.trigger(s.modal.AJAX_COMPLETE)});else this.$elm=i,this.anchor=i,this.$body.append(this.$elm),this.open()},s.modal.prototype={constructor:s.modal,open:function(){var o=this;this.block(),this.anchor.blur(),this.options.doFade?setTimeout(function(){o.show()},this.options.fadeDuration*this.options.fadeDelay):this.show(),s(t).off("keydown.modal").on("keydown.modal",function(o){var t=l();27===o.which&&t.options.escapeClose&&t.close()}),this.options.clickClose&&this.$blocker.click(function(o){o.target===this&&s.modal.close()})},close:function(){n.pop(),this.unblock(),this.hide(),s.modal.isActive()||s(t).off("keydown.modal")},block:function(){this.$elm.trigger(s.modal.BEFORE_BLOCK,[this._ctx()]),this.$body.css("overflow","hidden"),this.$blocker=s('<div class="'+this.options.blockerClass+' blocker current"></div>').appendTo(this.$body),e(),this.options.doFade&&this.$blocker.css("opacity",0).animate({opacity:1},this.options.fadeDuration),this.$elm.trigger(s.modal.BLOCK,[this._ctx()])},unblock:function(o){!o&&this.options.doFade?this.$blocker.fadeOut(this.options.fadeDuration,this.unblock.bind(this,!0)):(this.$blocker.children().appendTo(this.$body),this.$blocker.remove(),this.$blocker=null,e(),s.modal.isActive()||this.$body.css("overflow",""))},show:function(){this.$elm.trigger(s.modal.BEFORE_OPEN,[this._ctx()]),this.options.showClose&&(this.closeButton=s('<a href="#close-modal" rel="modal:close" class="close-modal '+this.options.closeClass+'">'+this.options.closeText+"</a>"),this.$elm.append(this.closeButton)),this.$elm.addClass(this.options.modalClass).appendTo(this.$blocker),this.options.doFade?this.$elm.css({opacity:0,display:"inline-block"}).animate({opacity:1},this.options.fadeDuration):this.$elm.css("display","inline-block"),this.$elm.trigger(s.modal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger(s.modal.BEFORE_CLOSE,[this._ctx()]),this.closeButton&&this.closeButton.remove();var o=this;this.options.doFade?this.$elm.fadeOut(this.options.fadeDuration,function(){o.$elm.trigger(s.modal.AFTER_CLOSE,[o._ctx()])}):this.$elm.hide(0,function(){o.$elm.trigger(s.modal.AFTER_CLOSE,[o._ctx()])}),this.$elm.trigger(s.modal.CLOSE,[this._ctx()])},showSpinner:function(){this.options.showSpinner&&(this.spinner=this.spinner||s('<div class="'+this.options.modalClass+'-spinner"></div>').append(this.options.spinnerHtml),this.$body.append(this.spinner),this.spinner.show())},hideSpinner:function(){this.spinner&&this.spinner.remove()},_ctx:function(){return{elm:this.$elm,$elm:this.$elm,$blocker:this.$blocker,options:this.options,$anchor:this.anchor}}},s.modal.close=function(o){if(s.modal.isActive())return o&&o.preventDefault(),(o=l()).close(),o.$elm},s.modal.isActive=function(){return 0<n.length},s.modal.getCurrent=l,s.modal.defaults={closeExisting:!0,escapeClose:!0,clickClose:!0,closeText:"Close",closeClass:"",modalClass:"modal",blockerClass:"jquery-modal",spinnerHtml:'<div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div>',showSpinner:!0,showClose:!0,fadeDuration:null,fadeDelay:1},s.modal.BEFORE_BLOCK="modal:before-block",s.modal.BLOCK="modal:block",s.modal.BEFORE_OPEN="modal:before-open",s.modal.OPEN="modal:open",s.modal.BEFORE_CLOSE="modal:before-close",s.modal.CLOSE="modal:close",s.modal.AFTER_CLOSE="modal:after-close",s.modal.AJAX_SEND="modal:ajax:send",s.modal.AJAX_SUCCESS="modal:ajax:success",s.modal.AJAX_FAIL="modal:ajax:fail",s.modal.AJAX_COMPLETE="modal:ajax:complete",s.fn.modal=function(o){return 1===this.length&&new s.modal(this,o),this},s(t).on("click.modal",'a[rel~="modal:close"]',s.modal.close),s(t).on("click.modal",'a[rel~="modal:open"]',function(o){o.preventDefault(),s(this).modal()})});
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).modals&&(Moloni.modals={}),Moloni.modals.ProductsProcessAll=async function(a){let n=jQuery,i=n("#action-modal");var o=i.find(".button-secondary");let t=i.find("#action-modal-spinner"),e=i.find("#action-modal-content");var l=i.find("#action-modal-error"),d=i.find("#action-modal-title-start"),c=i.find("#action-modal-title-end");let s=1,r=(e.html("").hide(),o.hide(),l.hide(),t.show(),d.show(),c.hide(),async()=>{var o=await n.ajax({type:"POST",url:ajaxurl,data:{action:a,page:s,nonce:molonionAjax.nonce},async:!0});if(1===s&&t.fadeOut(100,function(){e.fadeIn(200)}),e.html(o.overlayContent||"---"),o.hasMore&&i.is(":visible"))return s+=1,r()});i.modal({fadeDuration:0,escapeClose:!1,clickClose:!1,closeExisting:!0});try{await r()}catch(o){t.fadeOut(50),e.fadeOut(50),l.fadeIn(200)}d.hide(),c.show(),o.show(200)};
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).modals&&(Moloni.modals={}),Moloni.modals.ProductsProcessBulk=async function(r,a,t,s,o){let u=jQuery,p={create:[],stock:[],update:[]},_=u("#action-modal");var e=_.find(".button-secondary"),n=_.find("#action-modal-spinner");let m=_.find("#action-modal-content");var l=_.find("#action-modal-error"),d=_.find("#action-modal-title-start"),c=_.find("#action-modal-title-end");m.html("").show(),e.hide(),l.hide(),n.show(),d.show(),c.hide();let h=(o,e)=>{o={action:t,ml_product_id:o,wc_product_id:e,nonce:molonionAjax.nonce};return u.ajax({type:"POST",url:ajaxurl,data:o,async:!0})},f=(o,e)=>{o={action:a,ml_product_id:o,wc_product_id:e,nonce:molonionAjax.nonce};return u.ajax({type:"POST",url:ajaxurl,data:o,async:!0})};let v=async()=>{if(r.length){var o,e=u(r.shift()),a=e.closest(".product__row"),t=a.data("moloniId"),n=a.data("wcId"),l=a.find(".product__row-name").text().trim(),d=a.find(".product__row-reference").text().trim(),c=null,i=null;if(e.hasClass("checkbox_create_product")?(c=f.bind(this,t,n),i="create"):e.hasClass("checkbox_update_stock_product")&&(c=h.bind(this,t,n),i="stock"),c&&i)return e=l+" ("+d+")",m.html(s.processing_product+": "+e),(t=await c())&&t.valid?(p[i].push(e+": "+s.successfully_processed),o=u(t.product_row),a.replaceWith(o),o.addClass("product__row--new"),setTimeout(()=>{o.removeClass("product__row--new")},3e3)):(p[i].push(e+": "+s.error_in_the_process),console.log(t),a.addClass("product__row--error"),setTimeout(()=>{a.removeClass("product__row--error")},3e3)),_.is(":visible")?v():void 0}};_.modal({fadeDuration:0,escapeClose:!1,clickClose:!1,closeExisting:!0});try{await v(),(()=>{m.html("");let n=u('<div class="flex flex-col gap-3"></div>'),l=u('<div class="flex flex-col p-2 rounded bg-neutral-40 max-h-44 overflow-auto mt-2" style="display: none"></div>'),d=u('<a class="mt-1" href="#">'+s.click_to_see+"</a>"),c=u("<div></div>");[{name:"create",label:s.create_action},{name:"update",label:s.update_action},{name:"stock",label:s.stock_action}].forEach(o=>{if(p[o.name].length){let e=l.clone();var a=d.clone(),t=c.clone();p[o.name].forEach(o=>e.append("<div>"+o+"</div>")),a.on("click",function(){e.toggle(200)}),t.append("<div>"+s.completed+" "+p[o.name].length+" "+o.label+"</div>"),t.append(e,a),n.append(t)}}),m.append(n)})(),n.fadeOut(50)}catch(o){n.fadeOut(50),m.fadeOut(50),l.fadeIn(200),console.log(o)}d.hide(),c.show(),e.show(200),o&&o()};
var Moloni;(Moloni=void 0===Moloni?{}:Moloni).Automations=(t=>({init:function(){var n="invoice_auto_status_line",o=t("#"+"invoice_auto"),i=t("#"+n);o.length&&i.length&&(o.on("change",function(){1===parseInt(o.val())?i.show(200):i.hide(200)}),o.trigger("change"))}}))(jQuery);
var Moloni;(Moloni=void 0===Moloni?{}:Moloni).Login=(i=>({init:function(){var o,n,e;o=i("#login_button"),n=i("#client_secret"),e=i("#developer_id"),o.length&&n.length&&e.length&&n.add(e).on("keyup",function(){""===n.val()||""===e.val()?o.prop("disabled",!0):o.removeAttr("disabled")})}}))(jQuery);
var Moloni;(Moloni=void 0===Moloni?{}:Moloni).Logs=(o=>{var t;return{init:function(){t=o("#logs-context-modal")},openContextDialog:function(o){var n=JSON.stringify(o||{},null,2);t.find("#logs-context-modal-content").text(n),t.find("Button").off("click").on("click",function(){var o,t;o=n,(t=document.createElement("a")).setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(o)),t.setAttribute("download","log.txt"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}),t.modal()}}})(jQuery);
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).MoloniProducts&&(Moloni.MoloniProducts={}),Moloni.MoloniProducts=(l=>{var i;function a(){l("#importStocksButton").on("click",function(){s("import-stocks-modal","molonion_tools_mass_import_stock")}),l("#importProductsButton").on("click",function(){s("import-products-modal","molonion_tools_mass_import_product")});let o=l(".list_form");var c=l(".button-start-imports"),t=l(".search_button");let e=l(".checkbox_create_product:enabled"),n=l(".checkbox_update_stock_product:enabled");var d=l(".checkbox_create_product_master"),r=l(".checkbox_update_stock_product_master");e.add(n).off("change").on("change",function(){_(),u()}),c.off("click").on("click",function(){{let o=[];l(".checkbox_create_product:enabled:checked, .checkbox_update_stock_product:enabled:checked").each(function(){o.push(l(this))}),o.length&&Moloni.modals.ProductsProcessBulk(o,"molonion_tools_create_wc_product","molonion_tools_update_wc_stock",i,a)}}),d.off("click").on("click",function(){e.prop("checked",l(this).prop("checked")),u()}),r.off("click").on("click",function(){n.prop("checked",l(this).prop("checked")),u()}),t.off("click").on("click",function(){l("#moloni input[type=hidden][name=paged]").val("1"),o.submit()}),_(),u()}function u(){var o=l(".button-start-imports");l(".checkbox_create_product:enabled:checked, .checkbox_update_stock_product:enabled:checked").length?o.removeAttr("disabled"):o.attr("disabled",!0)}function _(){var o=l(".checkbox_create_product:enabled"),c=l(".checkbox_update_stock_product:enabled");o.length&&l(".checkbox_create_product_master").prop("checked",l(".checkbox_create_product:enabled:checked").length===o.length),c.length&&l(".checkbox_update_stock_product_master").prop("checked",l(".checkbox_update_stock_product:enabled:checked").length===c.length)}function s(o,c){o=l("#"+o);o.modal({fadeDuration:100,escapeClose:!1,clickClose:!1,showClose:!0}),o.find(".button-primary").off("click").on("click",function(){Moloni.modals.ProductsProcessAll(c)})}return{init:function(o){i=o||{},a()}}})(jQuery);
var Moloni;(Moloni=void 0===Moloni?{}:Moloni).OrdersBulkAction=function(o){var i=jQuery,e=i("#bulk-action-progress-modal"),t=i("#bulk-action-progress-message"),r=i("#bulk-action-progress-current"),n=i("#bulk-action-progress-total"),l=i("#bulk-action-progress-title-start"),c=i("#bulk-action-progress-title-finish"),d=0,s='<br><a class="wp-core-ui button-secondary" style="width: 80px; text-align: center; float:right" href="#" rel="modal:close">'+o.close+"</a>",a=[],u=[],h=[];function p(n,e){e=e||1e3,d++,r.html(d),setTimeout(function(){t.html(o.creatingDocument+" "+n);var e={action:"molonion_gen_invoice",id:n,nonce:molonionAjax.nonce};i.ajax({type:"POST",url:ajaxurl,data:e,success:m,async:!1})},e)}function m(e){t.html(e.message),(e.valid?(i("#moloni-pending-order-row-"+w()).remove(),u):h).push(e),b(),w()?p(w()):setTimeout(g,1e3)}function g(){l.hide(),c.show(),t.html(""),t.append(o.createdDocuments+" "+u.length),t.append("<br>"+o.documentsWithErrors+" "+h.length),t.append(s)}function f(n,e){e=e||1e3,d++,r.html(d),setTimeout(function(){t.html(o.discardingOrder+" "+n);var e={action:"molonion_discard_order",id:n,nonce:molonionAjax.nonce};i.ajax({type:"POST",url:ajaxurl,data:e,success:v,async:!1})},e)}function v(e){t.html(e.message),(e.valid?(i("#moloni-pending-order-row-"+w()).remove(),u):h).push(e),b(),w()?f(w()):setTimeout(k,1e3)}function k(){l.hide(),c.show(),t.html(""),t.append(o.discardedOrders+" "+u.length),t.append("<br>"+o.ordersWithErrors+" "+h.length),t.append(s)}function b(){a=a.slice(1)}function w(){return!(!a[0]||!a[0].value)&&a[0].value}function x(){e.modal({fadeDuration:100,escapeClose:!1,clickClose:!1,showClose:!0}),c.hide(),l.show()}function O(){u=[],h=[],d=0}i(".moloni-pending-orders-select-all").click(function(){i('input[id^="moloni-pending-order-"]').not(this).prop("checked",this.checked)}),i('input[id^="moloni-pending-order-"]').click(function(){var o=!0;i('input[id^="moloni-pending-order-"]').each(function(e,n){n.checked||(o=!1)}),i(".moloni-pending-orders-select-all").prop("checked",o)}),i(".tablenav #doAction").click(function(){var e=i("#bulk-action-selector-top").val();"bulkGenInvoice"===e?(x(),O(),(a=i('input[id^="moloni-pending-order-"]:checked'))&&0===a.length?t.html("<div>"+o.noOrdersSelected+s+"</div>"):(t.html(o.startingProcess),n.html(a.length),p(w()))):"bulkDiscardOrder"===e&&(x(),O(),(a=i('input[id^="moloni-pending-order-"]:checked'))&&0===a.length?t.html("<div>"+o.noOrdersSelected+s+"</div>"):(t.html(o.startingProcess),n.html(a.length),f(w())))})};
var Moloni;(Moloni=void 0===Moloni?{}:Moloni).Settings=(o=>{var r={};function d(e,n){var i=o("#"+e),l=o("#"+n);i.length&&l.length&&(i.on("change",function(){1===parseInt(i.val())?l.show(200):l.hide(200)}),i.trigger("change"))}return{init:function(e){r=e;var n=o("#prefix_preview"),i=o("#client_prefix"),l=(n.length&&i.length&&i.on("change",function(){n.text("("+r.example+": "+i.val()+")")}),d("document_status","create_bill_of_lading_line"),o("#document_type")),t=o("#document_status"),a=o("#create_bill_of_lading");l.length&&t.length&&a.length&&(l.on("change",function(){"invoiceAndReceipt"===l.val()?t.val(1).prop("disabled",!0).trigger("change"):t.prop("disabled",!1),["billsOfLading","estimate"].includes(l.val())?a.val(0).prop("disabled",!0).trigger("change"):a.prop("disabled",!1)}),l.trigger("change")),d("shipping_info","load_address_line"),d("load_address","load_address_custom_line")}}})(jQuery);
var Moloni;(Moloni=void 0===Moloni?{}:Moloni).Tools=(jQuery,{init:function(){}});
var Moloni;void 0===(Moloni=void 0===Moloni?{}:Moloni).WcProducts&&(Moloni.WcProducts={}),Moloni.WcProducts=(l=>{var a;function i(){l("#exportStocksButton").on("click",function(){s("export-stocks-modal","molonion_tools_mass_export_stock")}),l("#exportProductsButton").on("click",function(){s("export-products-modal","molonion_tools_mass_export_product")});let o=l(".list_form");var c=l(".button-start-exports"),e=l(".search_button");let t=l(".checkbox_create_product:enabled"),n=l(".checkbox_update_stock_product:enabled");var d=l(".checkbox_create_product_master"),r=l(".checkbox_update_stock_product_master");t.add(n).off("change").on("change",function(){_(),u()}),c.off("click").on("click",function(){{let o=[];l(".checkbox_create_product:enabled:checked, .checkbox_update_stock_product:enabled:checked").each(function(){o.push(l(this))}),o.length&&Moloni.modals.ProductsProcessBulk(o,"molonion_tools_create_moloni_product","molonion_tools_update_moloni_stock",a,i)}}),d.off("click").on("click",function(){t.prop("checked",l(this).prop("checked")),u()}),r.off("click").on("click",function(){n.prop("checked",l(this).prop("checked")),u()}),e.off("click").on("click",function(){l("#moloni input[type=hidden][name=paged]").val("1"),o.submit()}),_(),u()}function u(){var o=l(".button-start-exports");l(".checkbox_create_product:enabled:checked, .checkbox_update_stock_product:enabled:checked").length?o.removeAttr("disabled"):o.attr("disabled",!0)}function _(){var o=l(".checkbox_create_product:enabled"),c=l(".checkbox_update_stock_product:enabled");o.length&&l(".checkbox_create_product_master").prop("checked",l(".checkbox_create_product:enabled:checked").length===o.length),c.length&&l(".checkbox_update_stock_product_master").prop("checked",l(".checkbox_update_stock_product:enabled:checked").length===c.length)}function s(o,c){o=l("#"+o);o.modal({fadeDuration:100,escapeClose:!1,clickClose:!1,showClose:!0}),o.find(".button-primary").off("click").on("click",function(){Moloni.modals.ProductsProcessAll(c)})}return{init:function(o){a=o||{},i()}}})(jQuery);
let __=wp.i18n.__;jQuery(document).ready(function(){jQuery("#molonion-login-page-anchor").length&&Moloni.Login.init(),jQuery("#molonion-automations-page-anchor").length&&Moloni.Automations.init(),jQuery("#molonion-logs-page-anchor").length&&Moloni.Logs.init(),jQuery("#molonion-moloni-products-page-anchor").length&&Moloni.MoloniProducts.init({create_action:__("product creation processes.","moloni-on"),update_action:__("product update processes.","moloni-on"),stock_action:__("stock update processes.","moloni-on"),processing_product:__("Processing product","moloni-on"),successfully_processed:__("Successfully processed","moloni-on"),error_in_the_process:__("Error in the process","moloni-on"),click_to_see:__("Click to see","moloni-on"),completed:__("Completed","moloni-on")}),jQuery("#molonion-pending-orders-page-anchor").length&&Moloni.OrdersBulkAction({startingProcess:__("Starting process...","moloni-on"),noOrdersSelected:__("No orders selected to process","moloni-on"),creatingDocument:__("Creating document","moloni-on"),discardingOrder:__("Discarding order","moloni-on"),createdDocuments:__("Documents created:","moloni-on"),documentsWithErrors:__("Documents with errors:","moloni-on"),discardedOrders:__("Orders discarded:","moloni-on"),ordersWithErrors:__("Orders with errors:","moloni-on"),close:__("Close","moloni-on")}),jQuery("#molonion-settings-page-anchor").length&&Moloni.Settings.init({example:__("Example","moloni-on")}),jQuery("#molonion-tools-page-anchor").length&&Moloni.Tools.init(),jQuery("#molonion-wc-products-page-anchor").length&&Moloni.WcProducts.init({create_action:__("product creation processes.","moloni-on"),update_action:__("product update processes.","moloni-on"),stock_action:__("stock update processes.","moloni-on"),processing_product:__("Processing product","moloni-on"),successfully_processed:__("Successfully processed","moloni-on"),error_in_the_process:__("Error in the process","moloni-on"),click_to_see:__("Click to see","moloni-on"),completed:__("Completed","moloni-on")})});